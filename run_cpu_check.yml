---
- name: Run CPU Check Script on Target Host
  hosts: gpu_nodes
  gather_facts: no
  become: yes

  tasks:
    - name: Ensure logs directory exists
      file:
        path: /opt/scripts/logs
        state: directory
        mode: '0755'

    - name: Run cpu_checks.py script
      shell: python3 /opt/scripts/cpu_checks.py
      args:
        chdir: /opt/scripts/

    - name: Read log file content
      slurp:
        src: /opt/scripts/logs/cpu_checks.log
      register: cpu_log

    - name: Show CPU check log output
      debug:
        msg: "{{ cpu_log['content'] | b64decode }}"
